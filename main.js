(()=>{"use strict";class e{static getTime(){const e=new Date,t=e.getFullYear().toString().slice(2),d=e.getMonth()<10?`0${e.getMonth()+1}`:e.getMonth()+1;return`${e.getDate()<10?`0${e.getDate()}`:e.getDate()}.${d}.${t} ${e.getHours()<10?`0${e.getDate()}`:e.getHours()}:${e.getMinutes()<10?`0${e.getDate()}`:e.getMinutes()}`}}class t{constructor(e){this.tx=e}getBlock(){const t=document.createElement("div");t.className="text insert";const d=document.createElement("p");d.className="time";const o=e.getTime();d.textContent=`${o}`,t.append(d);const n=document.createElement("p");n.className="txt",n.textContent=this.tx,t.append(n);const i=document.createElement("p");return i.className="coordText",i.classList.add("coord"),t.append(i),t}}let d,o;const n=async e=>{if(!navigator.mediaDevices)return void alert("mediaDevices - NOT!!");let t;"Audio"===e?(t=document.getElementById("Audio"),d=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1})):(t=document.getElementById("Video"),d=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})),o=new MediaRecorder(d);const n=[];o.addEventListener("start",(()=>{console.log("Старт записи!")})),o.addEventListener("dataavailable",(e=>{console.log("data available"),n.push(e.data)})),o.addEventListener("stop",(()=>{console.log("Конец записи");const e=new Blob(n);t.src=URL.createObjectURL(e)})),o.start()},i=async e=>{o&&o.stop(),d&&d.getTracks().forEach((e=>e.stop()))};class s{constructor(e){this.fg=e}showP(){const e=document.querySelector(".popup");e&&e.remove();const t=document.createElement("div");t.className="popup";const d=document.createElement("h4");d.className="popup_h4",t.append(d);const o=document.createElement("p");let n,i;switch(this.fg){case"text":d.textContent="Поскольку Вы отказались предоставить данные геолокации, пожалуйста, введите в поле ниже.\n        Широта и долгота через запятую и пробел. При попытке отправить пустое поле, либо некорректных данных, будут введены следующие данные:\n        широта: 52,5213256511, долгота: 41,26515421316",t.append(d),n=document.createElement("textarea"),n.className="txtAr",t.append(n),i=document.createElement("button"),i.className="butP",i.textContent="Отправить",o.append(i);break;case"media":d.textContent="ВНИМАНИЕ!!!",t.append(d),o.textContent="Идет запись!!!"}return t.append(o),t}}function c(e){function t(){"coordAudio"!==e&&"coordVideo"!==e||(!function(){const e=document.getElementById("btcr"),t=document.getElementById("bttk"),d=document.getElementById("outT");d.innerHTML="00:00";let o=0,n=0,i=setInterval((()=>{n+=1,60===n&&(o+=1,n=0);const e=o<10?`0${o}`:`${o}`,t=n<10?`0${n}`:`${n}`;d.innerHTML=`${e}: ${t}`}),1e3);e.addEventListener("click",(()=>{clearInterval(i),o=0,i=null,n=0})),t.addEventListener("click",(()=>{clearInterval(i),o=0,i=null,n=0}))}(),"coordAudio"===e&&n("Audio"),"coordVideo"===e&&n("Video"))}navigator.geolocation.getCurrentPosition((function(d){const o=d.coords.latitude,n=d.coords.longitude;document.querySelector(`.${e}`).append(`Широта= ${o}  Долгота= ${n}`),t()}),(function(){const d=new s("text").showP();document.querySelector(".container").append(d),document.getElementById("note").style.width="0",document.getElementById("ta").setAttribute("disabled","disabled"),document.getElementById("record").style.width="0",d.querySelector(".butP").addEventListener("click",(()=>{const o=d.querySelector(".txtAr").value;let n,i;if(o)if(/^\d+.\d+, \d+.\d+$/gi.test(o)){const[e,t]=o.split(", ");n=e,i=t}else n="52.5213256511",i="41.26515421316";else n="52.5213256511",i="41.26515421316";document.querySelector(`.${e}`).append(`Широта: ${n}, Долгота: ${i}`),"coordText"===e?document.getElementById("note").style.width="150px":document.getElementById("record").style.width="150px",document.getElementById("ta").removeAttribute("disabled"),d.remove(),t()}))}))}class r{constructor(e){this.fg=e}getBlock(){const t=document.createElement("div");t.className=`${this.fg} insert`;const d=document.createElement("p");d.className="time";const o=e.getTime();d.textContent=`${o}`,t.append(d);const n=document.createElement(`${this.fg}`);n.id=`${this.fg}`,n.controls=!0,n.hidden=!0,t.append(n);const i=document.createElement("p");return i.className=`coord${this.fg}`,i.classList.add("coord"),t.append(i),t}}new class{constructor(){this.note=document.getElementById("note"),this.record=document.getElementById("record"),this.textarr=document.getElementById("ta"),this.butfon=document.getElementById("btf"),this.butvid=document.getElementById("btv"),this.blokText=document.getElementById("tt"),this.blokAudio=document.getElementById("ma"),this.blokVideo=document.getElementById("vo"),this.outT=document.getElementById("outT"),this.deleteMedia=document.getElementById("btcr"),this.writeMedia=document.getElementById("bttk"),this.writeN=document.getElementById("writN"),this.textarr.addEventListener("keydown",this.hendlerTextarr.bind(this)),this.textarr.addEventListener("click",this.hiddNote.bind(this)),this.textarr.addEventListener("blur",this.showNote.bind(this)),this.butfon.addEventListener("click",this.hendlerAudio.bind(this)),this.butvid.addEventListener("click",this.hedlerVideo.bind(this)),this.writeN.addEventListener("click",this.hendlerWriteN.bind(this))}showNote(){this.note.style.width="151px"}hiddNote(){this.note.style.width="0px",this.writeN.hidden=!1}showRecord(){this.record.style.width="151px",this.outT.removeAttribute("hidden")}hiddRecord(){this.record.style.width="0px",this.outT.setAttribute("hidden","hidden")}hendlerWriteN(){if(""===this.textarr.value)return alert("Нельзя отправить пустое место. Наберите пожалуйста Ваше сообщение."),this.textarr.value="",this.textarr.blur(),void(this.writeN.hidden=!0);const e=new t(this.textarr.value).getBlock();this.blokText.prepend(e),c("coordText"),this.textarr.value="",this.textarr.blur(),this.writeN.hidden=!0}hendlerTextarr(e){"NumpadEnter"===e.code&&this.hendlerWriteN(e)}hendlerAudio(){this.hiddNote(),this.writeN.hidden=!0,this.showRecord();const e=new s("media").showP();document.querySelector(".container").append(e);const t=new r("Audio").getBlock();this.blokAudio.prepend(t),c("coordAudio"),this.writeMedia.addEventListener("click",(()=>{e.remove(),document.getElementById("Audio").removeAttribute("hidden"),i(),this.hiddRecord(),this.showNote()})),this.deleteMedia.addEventListener("click",(async()=>{await i(),document.querySelector(".popup")&&document.querySelector(".popup").remove(),document.querySelector(".Audio").remove(),this.hiddRecord(),this.showNote()}))}hedlerVideo(){this.hiddNote(),this.writeN.hidden=!0,this.showRecord();const e=new s("media").showP();document.querySelector(".container").append(e);const t=new r("Video").getBlock();this.blokVideo.prepend(t),c("coordVideo"),this.writeMedia.addEventListener("click",(()=>{e.remove(),document.getElementById("Video").removeAttribute("hidden"),i(),this.hiddRecord(),this.showNote()})),this.deleteMedia.addEventListener("click",(async()=>{await i(),document.querySelector(".popup")&&document.querySelector(".popup").remove(),document.querySelector(".Video").remove(),this.hiddRecord(),this.showNote()}))}}})();